"use strict";!function(){var t=function(t,e){function n(){d3.select(u).select("svg").select("g").attr("transform","translate("+d3.event.transform.x+","+d3.event.transform.y+") scale("+d3.event.transform.k+")")}var r=e.layout.svgMargin,a=e.layout.svgWidth-e.layout.svgMargin.left-e.layout.svgMargin.right,i=e.layout.svgHeight-e.layout.svgMargin.top-e.layout.svgMargin.bottom,o=e.layout.nodeWidth,l=e.layout.nodeHeight,d=e.layout.nodeMargin,s=d3.zoom().scaleExtent(e.layout.zoomScale).on("zoom",n),c=e.layout.transitionDuration,u="#"+e.layout.divId,h=this,f=0;this.root=null,this.treeData=t,this.nodes=null,this.links=null,this.treemap=d3.tree().nodeSize([o+d.x,l+d.y]).separation(function(t,e){return t.parent==e.parent?1:1.25}),this.root=d3.hierarchy(this.treeData,function(t){return t.children});var p=d3.select(u).append("svg").attr("width",a+r.right+r.left).attr("height",i+r.top+r.bottom).append("g").append("g").attr("transform","translate("+a/2+","+(r.top+l)+")");d3.select(u).select("svg").call(s),this.resetZoom=function(){p.transition().call(s.transform,d3.zoomIdentity)},this.collapse=function(t){t.children&&(t._children=t.children,t._children.forEach(collapse),t.children=null)},this.expand=function(t){t._children&&(t.children=t._children,t.children.forEach(expand),t._children=null)},this.colapseAll=function(){root.children.forEach(collapse),update(root)},this.expandAll=function(){root.children.forEach(expand),update(root)},this.update=function(t){function e(t,e){var n="M "+t.x+" "+t.y+"\n\t\t\t\t            C "+(t.x+e.x)/2+" "+t.y+",\n\t\t\t\t              "+(t.x+e.x)/2+" "+e.y+",\n\t\t\t\t              "+e.x+" "+e.y;return n}function n(t){t.children?(t._children=t.children,t.children=null):(t.children=t._children,t._children=null),h.update(t)}this.treeData=this.treemap(this.root),this.nodes=this.treeData.descendants(),this.links=this.treeData.descendants().slice(1),this.nodes.forEach(function(t){t.y=t.depth*d.y});var r=p.selectAll("g.node").data(h.nodes,function(t){return t.id||(t.id=++f)}),a=r.enter().append("g").attr("class","node").attr("transform",function(e){if(t.x0)return"translate("+t.x0+","+t.y0+")"}).on("click",n);a.append("rect").attr("width",o/2).attr("height",l/2).attr("transform",function(t){return"translate("+-(o/4)+","+-(l/4)+")"}).attr("stroke","black").style("fill",function(t){return t._children?"lightsteelblue":"#fff"}),a.append("text").attr("dy",".35em").attr("text-anchor","middle").text(function(t){return t.data.name}),a.append("text").attr("dy",".65em").attr("x",function(t){if(t.parent)return(t.parent.x-t.x)/2}).attr("y",function(t){if(t.parent)return(t.parent.y-t.y)/2}).attr("text-anchor","middle").text(function(t){if(t.parent)return t.data.operator+" "+t.data.value});var i=a.merge(r);i.transition().duration(c).attr("transform",function(t){return"translate("+t.x+","+t.y+")"}),i.select("rect.node").attr("width",o).attr("height",l).style("fill",function(t){return t._children?"lightsteelblue":"#fff"}).attr("cursor","pointer");var s=r.exit().transition().duration(c).attr("transform",function(e){return"translate("+t.x+","+t.y+")"}).remove();s.select("rect").attr("width",0).attr("height",0),s.select("text").style("fill-opacity",1e-6);var u=p.selectAll("path.link").data(h.links,function(t){return t.id}),y=u.enter().insert("path","g").attr("class","link").attr("d",function(n){if(!t.x0)return e({x:0,y:0},{x:0,y:0});var r={x:t.x0,y:t.y0};return e(r,r)}),x=y.merge(u);x.transition().duration(c).attr("d",function(t){return e(t,t.parent)});u.exit().transition().duration(c).attr("d",function(n){var r={x:t.x,y:t.y};return e(r,r)}).remove();h.nodes.forEach(function(t){t.x0=t.x,t.y0=t.y})},this.update(this.root)};"function"==typeof define&&define.amd?define(function(){return t}):"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=t),exports.RuleBuilder=t):window.RuleBuilder=t}(void 0);